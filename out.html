
<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Smart News Summarizer Agent</title>
        <style>
            /* Professional, light palette */
            :root{--bg:#f5f7fb;--card:#ffffff;--muted:#6b7280;--accent:#5b6df6;--accent-2:#7b61d1}
            html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--bg);color:#0f172a}
            .site-header{background:linear-gradient(180deg,#eef3ff,#f7f9fc);padding:34px 20px;border-bottom:1px solid #e6e9f2}
            .site-header .title{max-width:1100px;margin:0 auto;font-size:2rem;font-weight:700;display:flex;align-items:center;gap:14px}
            .site-header .subtitle{max-width:1100px;margin:6px auto 0;color:var(--muted)}
            .container{max-width:1100px;margin:26px auto;padding:0 20px}
            .panel{background:var(--card);border:1px solid #eef1f8;border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(12,20,60,0.04)}
            .controls{display:flex;gap:12px;align-items:center}
            .controls .col{flex:1}
            .style-select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9f2;background:white}
            .toolbar{display:flex;gap:8px;align-items:center}
            .btn.secondary{background:#6b7280;color:white}
            .btn.print{background:#10b981;color:white}
            .btn[disabled]{opacity:0.6;cursor:not-allowed}
            /* improved font stack */
            label{display:block;font-weight:600;margin-bottom:8px;color:#111827}
            input[type=text]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #e6e9f2;font-size:1rem;font-family:Inter,Segoe UI,system-ui,-apple-system,Roboto,"Helvetica Neue",Arial}
            .actions{display:flex;gap:12px;margin-left:auto}
            .btn{border:0;padding:12px 18px;border-radius:10px;font-weight:700;color:white;cursor:pointer}
            .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));box-shadow:0 6px 20px rgba(91,109,246,0.18)}
            .btn.ghost{background:#f3f4f6;color:#111;border:1px solid #e7e9ee}
            .report-area{margin-top:18px;display:grid;grid-template-columns:1fr 320px;gap:18px}
            .report-main{background:var(--card);border-radius:10px;padding:18px;min-height:60vh;overflow:auto}
            .report-side{background:var(--card);border-radius:10px;padding:18px;height:60vh;overflow:auto;border:1px solid #eef1f8}
            .summary-card{border-left:4px solid rgba(91,109,246,0.18);padding:14px;border-radius:8px;margin-bottom:12px;background:linear-gradient(180deg,#fff,#fbfdff)}
            .summary-card h3{margin:0 0 8px;font-size:1.05rem}
            .summary-meta{font-size:0.9rem;color:var(--muted);margin-bottom:8px}
            .spinner{display:inline-block;width:20px;height:20px;border:3px solid #e6e9f2;border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
            @keyframes spin{to{transform:rotate(360deg)}}
            .status{margin-bottom:12px}
            footer{margin-top:18px;text-align:center;color:var(--muted)}
            @media (max-width:900px){.report-area{grid-template-columns:1fr;}.report-side{height:auto}}
        </style>
    </head>
    <body>
        <header class="site-header">
            <div class="title">üì∞ Smart News Summarizer Agent</div>
            <div class="subtitle">Automatically find recent news and create concise, professional summaries.</div>
        </header>

        <main class="container">
            <div class="panel">
                <div style="display:flex;gap:16px;align-items:center;flex-wrap:wrap">
                    <div style="flex:1;min-width:220px">
                        <label for="topic">üéØ Topic</label>
                        <input id="topic" type="text" placeholder="e.g. Climate change policy, AI safety" />
                    </div>
                    <div style="min-width:160px">
                        <label for="styleSelect">Style</label>
                        <select id="styleSelect" class="style-select" aria-label="Report style">
                            <option value="corporate" selected>Corporate</option>
                            <option value="standard">Standard</option>
                            <option value="serif">Serif</option>
                            <option value="mono">Monospace</option>
                        </select>
                    </div>
                    <div class="actions">
                        <button class="btn primary" id="searchBtn" type="button" onclick="searchNews()">üîç Search & Summarize</button>
                        <button class="btn ghost" id="clearBtn" type="button" onclick="clearResults()">üóëÔ∏è Clear</button>
                    </div>
                    <div style="margin-left:12px;display:flex;gap:8px;align-items:center">
                        <div class="toolbar">
                            <button class="btn secondary" id="exportBtn" type="button" title="Download report as HTML">‚¨áÔ∏è Export</button>
                            <button class="btn print" id="printBtn" type="button" title="Print report">üñ®Ô∏è Print</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="report-area">
                <section class="report-main panel" id="reportMain">
                        <div class="status" id="statusArea"></div>
                        <div id="errorArea" style="margin-bottom:12px;color:#7a1f1f;display:none"></div>
                    <div id="reportDisplay">
                        <div style="color:var(--muted)">No report yet ‚Äî enter a topic and click <strong>Search & Summarize</strong>.</div>
                    </div>
                </section>

                <aside class="report-side panel">
                    <h4 style="margin-top:0">Report Summary</h4>
                    <div id="statsBox" style="color:var(--muted)">No data</div>
                    <hr style="margin:12px 0;border:none;border-top:1px solid #eef1f8" />
                    <div id="recentBox" style="color:var(--muted)">No recent searches</div>
                </aside>
            </div>

            <footer>¬© Smart News Summarizer ‚Ä¢ Professional summaries for quick reading</footer>
        </main>

        <script>
            // fixed style (server-side uses this value)
            const FIXED_STYLE = 'corporate';

            function renderSummariesFromHtml(html){
                // server returns `report_html` (already sanitized by report_generator). Insert it.
                document.getElementById('reportDisplay').innerHTML = html;
            }

            function getCurrentReportHtml(data){
                // prefer server-provided HTML, otherwise render plain text into simple HTML
                if(data && data.report_html) return data.report_html;
                if(data && data.report){
                    const lines = data.report.split('
').filter(Boolean);
                    return '<div style="padding:12px;line-height:1.45">' + lines.map(l=>'<p style="margin:8px 0;color:#111">'+l.replace(/</g,'&lt;')+'</p>').join('') + '</div>';
                }
                return document.getElementById('reportDisplay').innerHTML;
            }

            function renderPlainReport(text){
                const container = document.getElementById('reportDisplay');
                // Convert newlines to paragraphs for readability
                const lines = text.split('
').filter(Boolean);
                container.innerHTML = lines.map(l => '<p style="margin:0 0 10px;color:#111">'+l.replace(/</g,'&lt;')+'</p>').join('');
            }

            function setStatus(message, isError){
                const s = document.getElementById('statusArea');
                s.innerHTML = isError ? '<div style="background:#fff1f0;padding:10px;border-radius:8px;color:#7a1f1f">‚ùå '+message+'</div>' : '<div style="background:#f3fbff;padding:10px;border-radius:8px;color:#0b56d9">'+message+'</div>';
            }

                async function searchNews(){
                const topic = document.getElementById('topic').value.trim();
                const style = (document.getElementById('styleSelect') && document.getElementById('styleSelect').value) || FIXED_STYLE;
                const searchBtn = document.getElementById('searchBtn');
                const exportBtn = document.getElementById('exportBtn');
                const printBtn = document.getElementById('printBtn');
                if(!topic){ setStatus('Please enter a topic', true); return }
                setLoading(true);
                setStatus('Searching... <span class="spinner"></span>');
                document.getElementById('reportDisplay').innerHTML = '';
                document.getElementById('errorArea').style.display = 'none';
                try{
                    const res = await fetch('/api/summarize', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({topic:topic,style:style})});
                    if(!res.ok){ const text = await res.text(); throw new Error(text || res.statusText); }
                    const data = await res.json();
                    if(data.success){
                        setStatus('Report generated successfully');
                        const html = getCurrentReportHtml(data);
                        renderSummariesFromHtml(html);
                        // populate stats
                        const s = data.stats || {};
                        document.getElementById('statsBox').innerHTML = `<div>Total: ${s.total||0}</div><div>Processed: ${s.processed||0}</div><div>Failed: ${s.failed||0}</div><div>Success rate: ${s.success_rate||0}%</div>`;
                        // add to recent searches
                        const rbox = document.getElementById('recentBox');
                        const entry = document.createElement('div'); entry.textContent = `${new Date().toLocaleString()}: ${topic}`; rbox.prepend(entry);
                        // enable export/print
                        if(exportBtn) exportBtn.disabled = false;
                        if(printBtn) printBtn.disabled = false;
                    } else {
                        const err = data.error || 'Error generating report';
                        setStatus(err, true);
                        document.getElementById('errorArea').textContent = err;
                        document.getElementById('errorArea').style.display = 'block';
                    }
                }catch(e){ setStatus('Network error: '+e.message, true); document.getElementById('errorArea').textContent = e.message; document.getElementById('errorArea').style.display='block'; }
                finally{ setLoading(false); }
                }

            function clearResults(){
                document.getElementById('reportDisplay').innerHTML='';
                document.getElementById('statsBox').innerHTML='No data';
                document.getElementById('statusArea').innerHTML='';
                document.getElementById('recentBox').innerHTML='';
                document.getElementById('topic').value='';
                if(document.getElementById('styleSelect')) document.getElementById('styleSelect').value = FIXED_STYLE;
            }

            // Attach event listeners to ensure buttons work even if HTML rendering changes
            document.addEventListener('DOMContentLoaded', function(){
                const sb = document.getElementById('searchBtn'); if(sb) sb.addEventListener('click', searchNews);
                const cb = document.getElementById('clearBtn'); if(cb) cb.addEventListener('click', clearResults);
                const topicInput = document.getElementById('topic');
                if(topicInput){
                    topicInput.addEventListener('keydown', function(e){ if(e.key === 'Enter'){ e.preventDefault(); searchNews(); } });
                }
                // expose functions on window for inline onclick fallback and older browsers
                try{ window.searchNews = searchNews; window.clearResults = clearResults; }catch(e){}
                // wire export/print buttons
                const exportBtn = document.getElementById('exportBtn');
                const printBtn = document.getElementById('printBtn');
                if(exportBtn) { exportBtn.disabled = true; exportBtn.addEventListener('click', function(){
                    const html = getCurrentReportHtml({report_html: document.getElementById('reportDisplay').innerHTML});
                    const blob = new Blob([html], {type: 'text/html'});
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a'); a.href = url; a.download = 'news_report.html'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
                }); }
                if(printBtn) { printBtn.disabled = true; printBtn.addEventListener('click', function(){
                    const html = getCurrentReportHtml({report_html: document.getElementById('reportDisplay').innerHTML});
                    const w = window.open('', '_blank'); if(!w) { alert('Popup blocked. Please allow popups.'); return }
                    w.document.open(); w.document.write('<html><head><title>Print Report</title><style>body{font-family:Inter,Segoe UI,Arial,sans-serif;padding:18px;color:#111}</style></head><body>'+html+'</body></html>'); w.document.close();
                    w.focus(); setTimeout(()=>{ w.print(); }, 250);
                }); }
            });

            function setLoading(on){
                const sb = document.getElementById('searchBtn');
                const cb = document.getElementById('clearBtn');
                const exp = document.getElementById('exportBtn');
                const pr = document.getElementById('printBtn');
                if(on){ if(sb) { sb.disabled = true; sb.innerHTML = 'Searching...'; } if(cb) cb.disabled = true; if(exp) exp.disabled = true; if(pr) pr.disabled = true; }
                else { if(sb) { sb.disabled = false; sb.innerHTML = 'üîç Search & Summarize'; } if(cb) cb.disabled = false; /* export/print enabled when report exists */ }
            }
        </script>
    </body>
</html>